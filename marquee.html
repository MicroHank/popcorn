<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è·‘é¦¬ç‡ˆç®¡ç† - æˆ‘çš„çˆ†ç±³èŠ±</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="assets/bootstrap-5.3.8-dist/css/bootstrap.min.css">
    <link href="assets/fonts/css2.css" rel="stylesheet">
    <style>
        body {
            background-color: #0f0f19;
            color: #fff;
            font-family: 'Outfit', 'Noto Sans TC', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        .admin-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            padding: 40px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .form-label {
            color: rgba(255, 255, 255, 0.7);
            font-weight: 600;
        }
        .form-control {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #fff;
            border-radius: 12px;
            padding: 12px;
        }
        .form-control:focus {
            background: rgba(0, 0, 0, 0.5);
            border-color: #FF6B6B;
            box-shadow: 0 0 10px rgba(255, 107, 107, 0.3);
            color: #fff;
        }
        .btn-primary {
            background: linear-gradient(135deg, #FF6B6B 0%, #FFD93D 100%);
            border: none;
            border-radius: 50px;
            padding: 12px;
            font-weight: 800;
            letter-spacing: 2px;
            margin-top: 20px;
        }
        #status {
            margin-top: 20px;
            text-align: center;
            font-weight: 700;
        }
    </style>
</head>
<body>

    <div class="admin-card">
        <h2 class="text-center mb-4">ğŸ“¢ è·‘é¦¬ç‡ˆç®¡ç†</h2>
        
        <div class="mb-3">
            <label class="form-label">ğŸ”‘ ç®¡ç†å¯†ç¢¼</label>
            <input type="password" id="password" class="form-control" placeholder="è«‹è¼¸å…¥è¨­å®šçš„ SECRET_TOKEN">
        </div>

        <div class="mb-3">
            <label class="form-label">ğŸ’¬ è·‘é¦¬ç‡ˆå…§å®¹</label>
            <textarea id="marqueeText" class="form-control" rows="3" placeholder="ä¾‹å¦‚ï¼šæ­¡è¿å…‰è‡¨ï¼ä»Šæ—¥å¤§ä»½çˆ†ç±³èŠ±ç‰¹åƒ¹ä¸­..."></textarea>
        </div>

        <div class="d-flex gap-2 mb-3">
            <button id="startBtn" class="btn btn-primary flex-grow-1 mt-0">é–‹å§‹ (Start)</button>
            <button id="stopBtn" class="btn btn-secondary flex-grow-1" style="border-radius: 50px; font-weight: 800;">åœæ­¢ (Stop)</button>
        </div>

        <div class="mb-3">
            <label class="form-label">âœ¨ ç‰¹æ•ˆç™¼é€ (Special Effects)</label>
            <div class="d-flex flex-wrap gap-2">
                <button class="btn btn-outline-info effect-btn flex-grow-1" data-effect="confetti" style="border-radius: 20px;">ğŸŒ¸ è³€æˆäº¤</button>
                <button class="btn btn-outline-light effect-btn flex-grow-1" data-effect="snow" style="border-radius: 20px;">â„ï¸ æ²’äººè¦è²·</button>
            </div>
        </div>

        <div id="status"></div>
        <div id="activeIndicator" class="text-center mt-2" style="font-size: 0.9rem; font-weight: 600;"></div>
        
        <div class="mt-4 text-center">
            <a href="index.html" style="color: rgba(255,255,255,0.3); text-decoration: none; font-size: 0.8rem;">è¿”å›é¦–é </a>
        </div>
    </div>

    <script src="assets/jquery/jquery-3.7.1.min.js"></script>
    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbz5qSfvk-8rtj-VUd66KIoWJtKkxKx5RzNOI6-bF0A6xvhu3rAqHgz6jAu96Bd-Mn8wpA/exec";

        $(document).ready(function() {
            let isCurrentlyActive = false;

            // é é¢è¼‰å…¥æ™‚å…ˆæŠ“å–ç›®å‰çš„æ–‡å­—èˆ‡ç‹€æ…‹
            function refreshStatus() {
                $.get(`${GAS_URL}?action=getMarquee`, function(data) {
                    if (data) {
                        if (data.text) $('#marqueeText').val(data.text);
                        isCurrentlyActive = data.active;
                        updateIndicator(isCurrentlyActive);
                    }
                });
            }

            function updateIndicator(isActive) {
                const $indicator = $('#activeIndicator');
                if (isActive) {
                    $indicator.css('color', '#6BCB77').text('â— ç›®å‰ç‹€æ…‹ï¼šæ’­æ”¾ä¸­');
                } else {
                    $indicator.css('color', '#999').text('â—‹ ç›®å‰ç‹€æ…‹ï¼šå·²åœæ­¢');
                }
            }

            refreshStatus();

            function sendUpdate(activeStatus) {
                const password = $('#password').val();
                const text = $('#marqueeText').val();
                const $status = $('#status');

                if (!password) {
                    $status.css('color', '#FF6B6B').text('âŒ è«‹è¼¸å…¥å¯†ç¢¼');
                    return;
                }

                $status.css('color', '#FFD93D').text('â³ æ­£åœ¨åŒæ­¥...');
                $('#startBtn, #stopBtn').prop('disabled', true);

                $.post(GAS_URL, JSON.stringify({
                    action: 'updateMarquee',
                    password: password,
                    text: text,
                    active: activeStatus
                }), function(response) {
                    const res = JSON.parse(response);
                    if (res.result === 'success') {
                        $status.css('color', '#6BCB77').text('âœ… åŸ·è¡ŒæˆåŠŸï¼');
                        isCurrentlyActive = activeStatus;
                        updateIndicator(activeStatus);
                    } else {
                        $status.css('color', '#FF6B6B').text('âŒ éŒ¯èª¤ï¼š' + res.message);
                    }
                }).fail(function() {
                    $status.css('color', '#FF6B6B').text('âŒ é€£ç·šä¼ºæœå™¨å¤±æ•—');
                }).always(function() {
                    $('#startBtn, #stopBtn').prop('disabled', false);
                });
            }

            $('#startBtn').click(function() {
                sendUpdate(true);
            });

            $('#stopBtn').click(function() {
                sendUpdate(false);
            });

            $('.effect-btn').click(function() {
                const effect = $(this).data('effect');
                const password = $('#password').val();
                const $status = $('#status');

                if (!password) {
                    $status.css('color', '#FF6B6B').text('âŒ è«‹è¼¸å…¥å¯†ç¢¼');
                    return;
                }

                $status.css('color', '#FFD93D').text('â³ æ­£åœ¨ç™¼é€ç‰¹æ•ˆ...');
                $(this).prop('disabled', true);

                $.post(GAS_URL, JSON.stringify({
                    action: 'updateMarquee',
                    password: password,
                    text: $('#marqueeText').val(),
                    active: isCurrentlyActive,
                    effect: effect
                }), function(response) {
                    const res = JSON.parse(response);
                    if (res.result === 'success') {
                        $status.css('color', '#6BCB77').text('âœ… ç‰¹æ•ˆç™¼é€æˆåŠŸï¼');
                    } else {
                        $status.css('color', '#FF6B6B').text('âŒ éŒ¯èª¤ï¼š' + res.message);
                    }
                }).fail(function() {
                    $status.css('color', '#FF6B6B').text('âŒ é€£ç·šä¼ºæœå™¨å¤±æ•—');
                }).always(() => {
                    $(this).prop('disabled', false);
                });
            });
        });
    </script>
</body>
</html>
